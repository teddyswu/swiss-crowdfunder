<div id="main" class="push py-14 mt-10 mt-lg-12">
  <div class="container mb-3">
    <%= render partial: 'shared/campaign_top', locals: { campaign: @campaign, is_track: @is_track } %>
  </div>
  <div class="container-fluid border-bottom bg-white mb-6 pt-3" id="menu">
    <div class="container">
      <div class="row">
        <div class="col-12 col-lg-8">
          <div class="nav-responsive">
            <ul class="nav nav-tabs nav-justified border-bottom-0">
              <li class="nav-item">
                <%= link_to "內容", campaign_path(params[:id], anchor: "menu") , :class => "nav-link "%>
              </li>
              <li class="nav-item d-lg-none">
                <a class="nav-link anchor" href="#rewards">回饋</a>
              </li>
              <li class="nav-item">
                <%= link_to "更新 <span class='text-primary'>#{@campaign.campaign_updates.size}</span>".html_safe, campaign_show_update_path(params[:id], anchor: "menu") , :class => "nav-link" %>
              </li>
              <li class="nav-item">
                <%= link_to "問答 <span class='text-primary'>#{@campaign.campaign_qas.size}</span>".html_safe, campaign_show_qa_path(params[:id], anchor: "menu") , :class => "nav-link"%>
              </li>
              <li class="nav-item">
                <%= link_to "留言 <span class='text-primary'>#{@campaign_replies.size}</span>".html_safe, campaign_show_reply_path(params[:id], anchor: "menu"), :class => "nav-link" %>
              </li>
              <li class="nav-item">
                <%= link_to "小農隊 <span class='text-primary'>#{@campaign.campaign_groups.size}</span>".html_safe, group_campaign_path(params[:id], anchor: "menu") , :class => "nav-link"%>
              </li>
              <li class="nav-item">
                <%= link_to "支持者 <span class='text-primary'>#{@campaign.orders.is_paid.size}</span>".html_safe, support_campaign_path(params[:id], anchor: "menu") , :class => "nav-link active"%>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-12 col-lg-4 d-none d-lg-block">
          <%= link_to "支持提案", campaign_goodies_path(@campaign), class: "btn btn-primary btn-block" %>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-12 col-lg-8 mb-lg-0 mb-5">
        <%= render partial: 'support', locals: { supporters: @campaign.orders.is_paid } %>
      </div>
      <div class="col-12 col-lg-4">
        <div class="pt-10 mb-3 d-lg-none" id="rewards">
          <div class="h5 font-weight-bold">回饋商品</div>
        </div>
        <% @campaign.goodies.order(:sort).each do |goody| %>
          <%= render partial: 'shared/goody', locals: { goody: goody } %>
        <% end %>
      </div>
    </div>
  </div>
</div>


<div class="container">
  <%= render partial: 'shared/campaign_top', locals: { campaign: @campaign, is_track: @is_track } %>
  <nav class="nav nav-pills nav_underlines mt-5 mt-md-0" id="campaignTab" role="tablist">
    <%= link_to "內容", campaign_path(params[:id]) , :class => "nav-item nav-link"%>
    <%= link_to "問與答", campaign_show_qa_path(params[:id]) , :class => "nav-item nav-link"%>
    <%= link_to "更新( #{@campaign.campaign_updates.size})", campaign_show_update_path(params[:id]) , :class => "nav-item nav-link" %>
    <%= link_to "留言(#{@campaign_replies.size})", campaign_show_reply_path(params[:id]), :class => "nav-item nav-link" %>
    <%= link_to "友善團隊(#{@campaign.campaign_groups.size})", group_campaign_path(params[:id]) , :class => "nav-item nav-link"%>
    <a class="nav-item nav-link active" id="nav-support-tab" data-toggle="tab" href="#nav-support" role="tab" aria-controls="nav-support">支持者(<%= @campaign.orders.is_paid.size %>)</a>    
    <!-- <a class="nav-item nav-link" id="nav-backers-tab" data-toggle="tab" href="#nav-backers" role="tab"aria-controls="nav-backers">Backers</a> -->
  </nav>
</div>
<hr class="mt-0 mb-4">
<div class="container">
  <div class="campaign_body">
    <div class="row">
      <div class="col-md-7 col-lg-8">
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade show active" id="nav-support" role="tabpanel" aria-labelledby="nav-support-tab">
            <article>
              <section>
                <%= render partial: 'support', locals: { supporters: @campaign.orders.is_paid } %>
              </section>
            </article>
          </div>
        </div>
      </div>
      <aside class="col-md-5 col-lg-4">
        <h2><%= t('campaigns.show.goodies') %></h2>
        <% @campaign.goodies.order(:sort).each do |goody| %>
          <%= render partial: 'shared/goody', locals: { goody: goody } %>
        <% end %>
      </aside>
    </div>
  </div>
</div>
<% content_for :javascript do %>
  <script>
  $(".btn_card").click(function() {
    var track_class = $("#track_btn").attr("class")
    $.post( "/tracks", { user_id: <%= current_user.id if current_user.present?%>, campaign: "<%= params[:id]%>" })
      .done(function( data ) {
        if (track_class.indexOf("-o")!=-1){
          alert( "追蹤完成" );
          $("#track_btn").removeClass("fa-bookmark-o");
          $("#track_btn").addClass("fa-bookmark");
        }
        else
        {
          alert( "追蹤取消" );
          $("#track_btn").removeClass("fa-bookmark");
          $("#track_btn").addClass("fa-bookmark-o"); 
        }
      });
  });
  </script>
<% end %>