<div class="container">
  <%= render partial: 'shared/campaign_top', locals: { campaign: @campaign, is_track: @is_track } %>
  <nav class="nav nav-pills nav_underlines mt-5 mt-md-0" id="campaignTab" role="tablist">
    <%= link_to "內容", campaign_path(params[:id]) , :class => "nav-item nav-link"%>
    <%= link_to "問與答", campaign_show_qa_path(params[:id]) , :class => "nav-item nav-link"%>
    <a class="nav-item nav-link active" id="nav-updates-tab" data-toggle="tab" href="#nav-updates" role="tab" aria-controls="nav-updates">更新(<%= @campaign.campaign_updates.size %>)</a>
    <%= link_to "留言(#{@campaign_replies.size})", campaign_show_reply_path(params[:id]), :class => "nav-item nav-link" %>
    <%= link_to "友善團隊(#{@campaign.campaign_groups.size})", group_campaign_path(params[:id]) , :class => "nav-item nav-link"%>
    <%= link_to "支持者(#{@campaign.orders.is_paid.size})", support_campaign_path(params[:id]) , :class => "nav-item nav-link"%>
    <!-- <a class="nav-item nav-link" id="nav-backers-tab" data-toggle="tab" href="#nav-backers" role="tab"aria-controls="nav-backers">Backers</a> -->
  </nav>
</div>
<hr class="mt-0 mb-4">
<div class="container">
  <div class="campaign_body">
    <div class="row">
      <div class="col-md-7 col-lg-8">
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade show active" id="nav-updates" role="tabpanel" aria-labelledby="nav-updates-tab">
            <article>
              <section>
                <% if user_signed_in? %>
                  <%= render partial: 'campaigns/update_from', locals: { campaign_update: @campaign_update } if current_user.id == @campaign.user_id %>
                <% end %>
                <%= render partial: 'campaigns/update', locals: { campaign_updates: @campaign_updates } %>
              </section>
            </article>
          </div>
        </div>
      </div>
      <aside class="col-md-5 col-lg-4">
        <h2><%= t('campaigns.show.goodies') %></h2>
        <% @campaign.goodies.order(:sort).each do |goody| %>
          <%= render partial: 'shared/goody', locals: { goody: goody } %>
        <% end %>
      </aside>
    </div>
  </div>
</div>
<% content_for :javascript do %>
  <script>
  $(".btn_card").click(function() {
    var track_class = $("#track_btn").attr("class")
    $.post( "/tracks", { user_id: <%= current_user.id if current_user.present?%>, campaign: "<%= params[:id]%>" })
      .done(function( data ) {
        if (track_class.indexOf("-o")!=-1){
          alert( "追蹤完成" );
          $("#track_btn").removeClass("fa-bookmark-o");
          $("#track_btn").addClass("fa-bookmark");
        }
        else
        {
          alert( "追蹤取消" );
          $("#track_btn").removeClass("fa-bookmark");
          $("#track_btn").addClass("fa-bookmark-o"); 
        }
      });
  });
  </script>
<% end %>